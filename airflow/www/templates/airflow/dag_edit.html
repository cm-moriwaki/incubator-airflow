{% extends "airflow/dag.html" %}

{% block title %}
    {{ title }}
{% endblock %}

{% block head_css %}
{{ super() }}
<link rel="stylesheet" type="text/css"
      href="{{ url_for("static", filename="bootstrap-editable.css") }}">
{% endblock %}

{% block body %}
{{ super() }}
<h2>パラメータ</h2>
<table class="table table-striped table-bordered">
    <tr>
        <th>タスク名</td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{{ dag.dag_id }}</a></td>
    </tr>
    <tr>
        <th>スケジュール</td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{{ dag.schedule_interval_pp }}</a></td>
    </tr>
</table >
<br>
<h2>対象テーブル</h2>
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>ジョブ名</th>
            <th>テーブル種別</th>
            <th>スキーマ名</th>
            <th>テーブル名</th>
            <th>S3オブジェクトのプレフィックス</th>
            <th>ソートキー</th>
            <th>分散スタイル</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    {% for target in dag.csa_target_tables %}
    <tr>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{{ target.csa_job_name }}</a></td>
        <td><a href="#" class="editable_is_master" data-type="select" data-placement="right">{%- if target.csa_is_master %}全件{%- else %}差分{%- endif %}</a></td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{{ target.csa_schema_name }}</a></td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{{ target.csa_table_name }}</a></td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{%- if target.csa_s3_key_prefix %}{{ target.csa_s3_key_prefix }}{%- else %}{%- endif %}</a></td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{%- if target.csa_s3_sort_keys %}{{ target.csa_s3_sort_keys }}{%- else %}{%- endif %}</a></td>
        <td><a href="#" class="editable_input" data-type="text" data-placement="right">{%- if target.csa_s3_dist_style %}{{ target.csa_s3_dist_style }}{%- else %}{%- endif %}</a></td>
        <td><nobr>
            <button class="btn btn-default btn-sm move down" type="submit"><span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span></button>
            <button class="btn btn-default btn-sm move up" type="submit"><span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span></button>
            <button class="btn btn-default btn-sm add" type="submit"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button>
            <button class="btn btn-default btn-sm delete" type="submit"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>
        </nobr></td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<div class="form-group">
    <button class="btn btn-primary" type="submit">セーブ</button>
    <button class="btn btn-danger" type="submit">キャンセル</button>
</div>
{% endblock %}

{% block tail %}
{{ super() }}
    <script src="{{ url_for('static', filename='bootstrap-editable.min.js')}}" type="text/javascript"></script>
    <script>
     $(document).ready(function() {
         $.fn.editable.defaults.mode = 'inline';

         $('.editable_input').editable({
             emptytext: 'None'
         });
         $('.editable_is_master').editable({
             source : [
                 {value: '1', text: '全件'},
                 {value: '0', text: '差分'}
             ]
         });

         $('table').on('click','.delete',function(){
             $(this).parents('tr').remove();
         });

         $('table').on('click','.add',function(){
             var row = $(this).closest('tr');
             var clone = row.clone();
             row.after(clone)
         });

         $('table').on('click','.move',function(){
             var row = $(this).closest('tr');
             if ($(this).hasClass('up')){
                 row.prev().before(row);
             }else{
                 row.next().after(row);
             }
         });
     });
    </script>
{% endblock %}
